generator client {
  provider        = "prisma-client-js"
  previewFeatures = ["views"]
}

datasource db {
  provider = "postgresql"
  schemas  = ["diner"]
}

/// This table contains check constraints and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
model client {
  id_client   String   @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  cpf         String   @unique @db.VarChar(14)
  email       String?  @unique @db.VarChar(35)
  phone       String?  @unique @db.VarChar(26)
  address_1   String   @db.VarChar(60)
  address_2   String?  @db.VarChar(60)
  complement  String?  @db.VarChar(70)
  observation String?  @db.VarChar(60)
  orders      orders[]

  @@schema("diner")
}

model foods {
  id_food                                        String           @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  xid_categorie                                  String           @db.Uuid
  name                                           String           @db.VarChar(30)
  description                                    String
  img                                            String           @default("logos/logo") @db.VarChar(35)
  price                                          Decimal          @db.Decimal(6, 2)
  promotion                                      Decimal?         @db.Decimal(7, 2)
  stock                                          Boolean          @default(true)
  sale                                           Boolean          @default(true)
  created_at                                     DateTime?        @default(now()) @db.Timestamp(6)
  foods_categories                               foods_categories @relation(fields: [xid_categorie], references: [id], onDelete: Cascade, onUpdate: NoAction)
  foods_addons_foods_addons_xid_food_baseTofoods foods_addons[]   @relation("foods_addons_xid_food_baseTofoods")
  foods_addons_foods_addons_xid_foodTofoods      foods_addons[]   @relation("foods_addons_xid_foodTofoods")
  foods_version                                  foods_version[]

  @@schema("diner")
}

model foods_addons {
  id_foods_addon                          String         @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  xid_food_base                           String         @db.Uuid
  xid_food                                String         @db.Uuid
  xid_food_version                        String?        @db.Uuid
  free                                    Boolean        @default(false)
  created_at                              DateTime?      @default(now()) @db.Timestamp(6)
  foods_foods_addons_xid_food_baseTofoods foods          @relation("foods_addons_xid_food_baseTofoods", fields: [xid_food_base], references: [id_food], onDelete: Cascade, onUpdate: NoAction)
  foods_foods_addons_xid_foodTofoods      foods          @relation("foods_addons_xid_foodTofoods", fields: [xid_food], references: [id_food], onDelete: Cascade, onUpdate: NoAction)
  foods_version                           foods_version? @relation(fields: [xid_food_version], references: [id_food_version], onDelete: Cascade, onUpdate: NoAction)

  @@unique([xid_food_base, xid_food, xid_food_version], map: "uq_tabela_ids")
  @@schema("diner")
}

model foods_categories {
  id String @id @default(dbgenerated("gen_random_uuid()")) @map("id_foods_categories") @db.Uuid
  name                String  @unique @db.VarChar(35)
  position_menu       Int     @unique(map: "uq_foods_categories_position_menu")
  position_addons     Int     @unique(map: "uq_foods_categories_position_addons")
  foods               foods[]

  @@schema("diner")
}

model foods_version {
  id_food_version String         @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  xid_food        String         @db.Uuid
  name            String         @db.VarChar(30)
  description     String?
  price           Decimal        @db.Decimal(10, 2)
  promotion       Decimal?       @db.Decimal(10, 2)
  stock           Boolean        @default(true)
  sale            Boolean        @default(true)
  created_at      DateTime?      @default(now()) @db.Timestamp(6)
  foods_addons    foods_addons[]
  foods           foods          @relation(fields: [xid_food], references: [id_food], onDelete: Cascade, onUpdate: NoAction)

  @@schema("diner")
}

model orders {
  id_order          String              @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  xid_client        String              @db.Uuid
  total_price       Decimal             @db.Decimal(10, 2)
  resume_string     String
  status            String              @db.VarChar(30)
  created_at        DateTime?           @default(now()) @db.Timestamp(6)
  client            client              @relation(fields: [xid_client], references: [id_client], onDelete: Cascade, onUpdate: NoAction)
  orders_food       orders_food[]
  orders_food_addon orders_food_addon[]

  @@schema("diner")
}

model orders_food {
  id_order_food   String    @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  xid_order       String    @db.Uuid
  food_id         String    @db.Uuid
  food_version_id String?   @db.Uuid
  price           Decimal   @db.Decimal(10, 2)
  created_at      DateTime? @default(now()) @db.Timestamp(6)
  orders          orders    @relation(fields: [xid_order], references: [id_order], onDelete: Cascade, onUpdate: NoAction)

  @@schema("diner")
}

model orders_food_addon {
  id_order_food_addon String    @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  xid_order           String    @db.Uuid
  xid_foods_addons    String    @db.Uuid
  price               Decimal   @db.Decimal(10, 2)
  created_at          DateTime? @default(now()) @db.Timestamp(6)
  orders              orders    @relation(fields: [xid_order], references: [id_order], onDelete: NoAction, onUpdate: NoAction)

  @@schema("diner")
}

model settings {
  id_settings String @id
  info        String

  @@schema("diner")
}

model settings_colors {
  id_settings_colors String    @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  name               String    @unique @db.VarChar(30)
  value              String    @db.VarChar(50)
  value_default      String    @db.VarChar(50)
  calc_color         Decimal[] @db.Decimal(10, 2)
  based_themaatic    Boolean

  @@schema("diner")
}

view foods_full {
  id_food        String?  @db.Uuid
  name           String?  @db.VarChar(30)
  description    String?
  img            String?  @db.VarChar(35)
  id_categorie   String?  @db.Uuid
  name_categorie String?  @db.VarChar(35)
  price          Decimal? @db.Decimal(6, 2)
  promotion      Decimal? @db.Decimal(7, 2)
  stock          Boolean?
  sale           Boolean?
  versions       Json?
  addons         Json?

  @@schema("diner")
}

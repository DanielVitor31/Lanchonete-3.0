generator client {
  provider        = "prisma-client-js"
  previewFeatures = ["views"]
}

datasource db {
  provider = "postgresql"
  schemas  = ["diner"]
}

/// This table contains check constraints and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
model client {
  id_client   String    @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  cpf         String    @unique @db.VarChar(14)
  email       String?   @unique @db.VarChar(35)
  phone       String?   @unique @db.VarChar(26)
  address_1   String    @db.VarChar(60)
  address_2   String?   @db.VarChar(60)
  complement  String?   @db.VarChar(70)
  observation String?   @db.VarChar(60)
  created_at  DateTime  @default(now()) @db.Timestamp(6)
  orders      orders[]
  payment     payment[]

  @@schema("diner")
}

model extra_ingredients {
  id_extra_ingredient     String                    @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  name                    String                    @unique @db.VarChar(30)
  description             String?
  img                     String                    @default("logos/logo") @db.VarChar(35)
  price                   Decimal                   @db.Decimal(6, 2)
  promotion               Decimal?                  @db.Decimal(7, 2)
  qty_max                 Int
  stock                   Boolean                   @default(true)
  sale                    Boolean                   @default(true)
  created_at              DateTime                  @default(now()) @db.Timestamp(6)
  foods_extra_ingredients foods_extra_ingredients[]

  @@schema("diner")
}

model foods {
  id_food                                        String                    @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  xid_categorie                                  String                    @db.Uuid
  name                                           String                    @unique @db.VarChar(30)
  description                                    String
  img                                            String                    @default("logos/logo") @db.VarChar(35)
  price                                          Decimal                   @db.Decimal(6, 2)
  promotion                                      Decimal?                  @db.Decimal(7, 2)
  stock                                          Boolean                   @default(true)
  sale                                           Boolean                   @default(true)
  created_at                                     DateTime                  @default(now()) @db.Timestamp(6)
  foods_categories                               foods_categories          @relation(fields: [xid_categorie], references: [id_foods_categories], onDelete: Cascade, onUpdate: NoAction)
  foods_addons_foods_addons_xid_foodTofoods      foods_addons[]            @relation("foods_addons_xid_foodTofoods")
  foods_addons_foods_addons_xid_food_baseTofoods foods_addons[]            @relation("foods_addons_xid_food_baseTofoods")
  foods_extra_ingredients                        foods_extra_ingredients[]
  foods_version                                  foods_version[]

  @@schema("diner")
}

model foods_addons {
  id_foods_addon                          String         @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  xid_food_base                           String         @db.Uuid
  xid_food                                String         @db.Uuid
  xid_food_version                        String?        @db.Uuid
  free                                    Boolean        @default(false)
  created_at                              DateTime       @default(now()) @db.Timestamp(6)
  food      foods          @relation("foods_addons_xid_foodTofoods", fields: [xid_food], references: [id_food], onDelete: Cascade, onUpdate: NoAction, map: "food")
  food_base foods          @relation("foods_addons_xid_food_baseTofoods", fields: [xid_food_base], references: [id_food], onDelete: Cascade, onUpdate: NoAction, map: "food_base")
  food_version                           foods_version? @relation(fields: [xid_food_version], references: [id_food_version], onDelete: Cascade, onUpdate: NoAction, map: "food_version")

  @@unique([xid_food_base, xid_food, xid_food_version], map: "uq_tabela_ids")
  @@schema("diner")
}

model foods_categories {
  id_foods_categories String   @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  name                String   @unique @db.VarChar(35)
  position_menu       Int      @unique
  position_addons     Int      @unique
  created_at          DateTime @default(now()) @db.Timestamp(6)
  foods               foods[]

  @@schema("diner")
}

model foods_extra_ingredients {
  id_foods_extra_ingredients String            @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  xid_food                   String            @db.Uuid
  xid_extra_ingredient       String            @db.Uuid
  extra_ingredients          extra_ingredients @relation(fields: [xid_extra_ingredient], references: [id_extra_ingredient], onDelete: Cascade, onUpdate: NoAction)
  foods                      foods             @relation(fields: [xid_food], references: [id_food], onDelete: Cascade, onUpdate: NoAction)

  @@unique([xid_food, xid_extra_ingredient])
  @@schema("diner")
}

model foods_version {
  id_food_version String         @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  xid_food        String         @db.Uuid
  name            String         @db.VarChar(30)
  description     String?
  price           Decimal        @db.Decimal(10, 2)
  promotion       Decimal?       @db.Decimal(10, 2)
  stock           Boolean        @default(true)
  sale            Boolean        @default(true)
  created_at      DateTime       @default(now()) @db.Timestamp(6)
  foods_addons    foods_addons[]
  foods           foods          @relation(fields: [xid_food], references: [id_food], onDelete: Cascade, onUpdate: NoAction)

  @@schema("diner")
}

/// This table contains check constraints and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
model orders {
  id_order      String        @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  xid_client    String        @db.Uuid
  xid_payment   String?       @db.Uuid
  total_price   Decimal       @db.Decimal(10, 2)
  resume_string String
  status        String        @db.VarChar(30)
  created_at    DateTime      @default(now()) @db.Timestamp(6)
  client        client        @relation(fields: [xid_client], references: [id_client], onDelete: Cascade, onUpdate: NoAction)
  payment       payment?      @relation(fields: [xid_payment], references: [id_payment], onDelete: Cascade, onUpdate: NoAction)
  orders_food   orders_food[]

  @@schema("diner")
}

model orders_food {
  id_order_food                 String                          @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  xid_order                     String                          @db.Uuid
  food_id                       String                          @db.Uuid
  food_version_id               String?                         @db.Uuid
  price                         Decimal                         @db.Decimal(10, 2)
  created_at                    DateTime                        @default(now()) @db.Timestamp(6)
  orders                        orders                          @relation(fields: [xid_order], references: [id_order], onDelete: Cascade, onUpdate: NoAction)
  orders_food_addon             orders_food_addon[]
  orders_food_extra_ingredients orders_food_extra_ingredients[]

  @@schema("diner")
}

model orders_food_addon {
  id_order_food_addon String      @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  xid_order_food      String      @db.Uuid
  foods_addons_id     String      @db.Uuid
  price               Decimal     @db.Decimal(10, 2)
  created_at          DateTime    @default(now()) @db.Timestamp(6)
  orders_food         orders_food @relation(fields: [xid_order_food], references: [id_order_food], onDelete: Cascade, onUpdate: NoAction)

  @@schema("diner")
}

model orders_food_extra_ingredients {
  id_orders_food_extra_ingredients String      @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  xid_order_food                   String      @db.Uuid
  foods_extra_ingredients_id       String      @db.Uuid
  price_unit                       Decimal     @db.Decimal(10, 2)
  qty_chosen                       Int
  price_total                      Decimal     @db.Decimal(10, 2)
  created_at                       DateTime    @default(now()) @db.Timestamp(6)
  orders_food                      orders_food @relation(fields: [xid_order_food], references: [id_order_food], onDelete: Cascade, onUpdate: NoAction)

  @@schema("diner")
}

model payment {
  id_payment   String   @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  xid_client   String   @db.Uuid
  total_price  Decimal  @db.Decimal(10, 2)
  type_price   String   @db.VarChar(30)
  payment_date DateTime @default(now()) @db.Timestamp(6)
  orders       orders[]
  client       client   @relation(fields: [xid_client], references: [id_client], onDelete: Cascade, onUpdate: NoAction)

  @@schema("diner")
}

model settings {
  id_settings String @id
  info        String

  @@schema("diner")
}

model settings_colors {
  id_settings_colors String    @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  name               String    @unique @db.VarChar(30)
  value              String    @db.VarChar(50)
  value_default      String    @db.VarChar(50)
  calc_color         Decimal[] @db.Decimal(10, 2)
  based_themaatic    Boolean

  @@schema("diner")
}

view foods_full {
  id_food           String?  @db.Uuid
  name              String?  @db.VarChar(30)
  description       String?
  img               String?  @db.VarChar(35)
  id_categorie      String?  @db.Uuid
  name_categorie    String?  @db.VarChar(35)
  price             Decimal? @db.Decimal(6, 2)
  promotion         Decimal? @db.Decimal(7, 2)
  stock             Boolean?
  sale              Boolean?
  versions          Json?
  addons            Json?
  extra_ingredients Json?

  @@schema("diner")
}
